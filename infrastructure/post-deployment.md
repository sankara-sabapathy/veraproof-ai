# Post-Deployment Steps for VeraProof AI

## Deployment Status

‚úÖ **Storage Stack** - Deployed
‚úÖ **Auth Stack** - Deployed  
‚úÖ **Frontend Stack** - Deployed
üîÑ **Lightsail Stack** - Deploying...

## Once Lightsail Stack Completes

### 1. Retrieve All Stack Outputs

Run the output display script:

**Windows:**
```powershell
.\show-outputs.ps1 prod
```

**Linux/Mac:**
```bash
./show-outputs.sh prod
```

### 2. Get Lightsail Database Password

The database password is auto-generated by Lightsail. Retrieve it:

```bash
aws lightsail get-relational-database-master-user-password \
  --relational-database-name veraproof-db-prod \
  --region ap-south-1
```

Store this password in SSM Parameter Store:

```bash
aws ssm put-parameter \
  --name "/veraproof/prod/database/password" \
  --value "YOUR_PASSWORD_HERE" \
  --type "SecureString" \
  --overwrite \
  --region ap-south-1
```

### 3. Get Database Connection Details

```bash
aws lightsail get-relational-database \
  --relational-database-name veraproof-db-prod \
  --region ap-south-1 \
  --query 'relationalDatabase.masterEndpoint'
```

### 4. Deploy Backend Container to Lightsail

The Lightsail Container Service is created but needs a container deployment.

**Option A: Via GitHub Actions (Recommended)**
- Push to master branch
- GitHub Actions will automatically build and deploy

**Option B: Manual Deployment**

1. Build and push Docker image:
```bash
cd backend
docker build -t veraproof-api:latest .
```

2. Push to Lightsail:
```bash
aws lightsail push-container-image \
  --service-name veraproof-api-prod \
  --label veraproof-api \
  --image veraproof-api:latest \
  --region ap-south-1
```

3. Create deployment JSON (save as `deployment.json`):
```json
{
  "containers": {
    "app": {
      "image": ":veraproof-api-prod.veraproof-api.1",
      "ports": {
        "8000": "HTTP"
      },
      "environment": {
        "STAGE": "prod",
        "AWS_REGION": "ap-south-1"
      }
    }
  },
  "publicEndpoint": {
    "containerName": "app",
    "containerPort": 8000,
    "healthCheck": {
      "path": "/health",
      "intervalSeconds": 30
    }
  }
}
```

4. Deploy:
```bash
aws lightsail create-container-service-deployment \
  --service-name veraproof-api-prod \
  --cli-input-json file://deployment.json \
  --region ap-south-1
```

### 5. Update Frontend Configuration

Once the Lightsail API URL is available, update the frontend environment files with:
- API URL
- Cognito User Pool ID
- Cognito Client ID

### 6. Deploy Frontend

**Dashboard:**
```bash
cd partner-dashboard
npm run build
aws s3 sync dist/ s3://veraproof-dashboard-prod-612850243659/ --delete
aws cloudfront create-invalidation --distribution-id E22HOO32XSEYNN --paths "/*"
```

**Verification Page:**
```bash
# Build verification page
aws s3 sync verification-page/ s3://veraproof-verification-prod-612850243659/ --delete
aws cloudfront create-invalidation --distribution-id E3A2H3IT5ET3I0 --paths "/*"
```

## Deployed Resources Summary

### Auth (Cognito)
- User Pool ID: `ap-south-1_l4nlq0n8y`
- Client ID: `2b7tq4gj7426iamis9snrrh2fo`
- Domain: `veraproof-auth-prod.auth.ap-south-1.amazoncognito.com`

### Storage (S3)
- Artifacts: `veraproof-artifacts-prod-612850243659`
- Branding: `veraproof-branding-prod-612850243659`

### Frontend (CloudFront)
- Dashboard: `https://d3gc0en9my7apv.cloudfront.net`
- Verification: `https://dmieqia655oqd.cloudfront.net`

### Lightsail (Pending)
- Container Service: `veraproof-api-prod`
- Database: `veraproof-db-prod`
- API URL: (will be available after deployment)

## Testing

### 1. Test API Health
```bash
curl https://YOUR_LIGHTSAIL_URL/health
```

### 2. Test Cognito Authentication
Visit the dashboard URL and try to sign up/login.

### 3. Test Verification Flow
Visit the verification URL and test the video verification flow.

## Monitoring

### CloudWatch Logs
- Lightsail Container logs are automatically sent to CloudWatch
- Log group: `/aws/lightsail/veraproof-api-prod`

### Lightsail Metrics
View in AWS Console:
- Container Service metrics (CPU, Memory, Network)
- Database metrics (Connections, CPU, Storage)

## Cost Monitoring

**Free Tier (First 3 Months):**
- Lightsail Container (Micro): $0
- Lightsail Database (Micro): $0
- Total: ~$5-10/month (S3, CloudFront, Cognito)

**After Free Tier:**
- Lightsail Container: $10/month
- Lightsail Database: $15/month
- Other services: ~$5-10/month
- **Total: ~$30-35/month**

## Troubleshooting

### Container Won't Start
1. Check CloudWatch logs
2. Verify environment variables
3. Check database connectivity

### Database Connection Issues
1. Verify password in SSM
2. Check security group rules (Lightsail auto-configures)
3. Verify database is in "Available" state

### Frontend Not Loading
1. Check CloudFront distribution status
2. Verify S3 bucket policy
3. Check browser console for errors

## Next Steps

1. ‚úÖ Wait for Lightsail stack deployment to complete
2. ‚è≥ Retrieve database password
3. ‚è≥ Deploy backend container
4. ‚è≥ Deploy frontend applications
5. ‚è≥ Test end-to-end flow
6. ‚è≥ Set up monitoring alerts
7. ‚è≥ Configure custom domain (optional)
