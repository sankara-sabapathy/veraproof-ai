<div class="subscription-overview">
  <p-card *ngIf="subscription$ | async as subscription; else loading">
    <ng-template pTemplate="header">
      <div class="card-header">Current Subscription</div>
    </ng-template>
    <ng-template pTemplate="content">
      <div class="subscription-details">
        <div class="detail-row">
          <span class="label">Plan:</span>
          <p-chip [label]="subscription.subscription_tier" styleClass="plan-chip"></p-chip>
        </div>
        <div class="detail-row">
          <span class="label">Monthly Quota:</span>
          <span class="value">{{ subscription.monthly_quota | number }} verifications</span>
        </div>
        <div class="detail-row">
          <span class="label">Current Usage:</span>
          <span class="value">{{ subscription.current_usage | number }} / {{ subscription.monthly_quota | number }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Remaining:</span>
          <span class="value">{{ subscription.remaining_quota | number }} verifications</span>
        </div>
        
        <div class="quota-progress">
          <p-progressBar 
            [value]="subscription.usage_percentage"
            [showValue]="false"
            [styleClass]="'usage-' + getUsageColor(subscription.usage_percentage)">
          </p-progressBar>
          <span class="progress-label">{{ subscription.usage_percentage | number:'1.0-1' }}% used</span>
        </div>

        <p-divider></p-divider>

        <div class="detail-row">
          <span class="label">Billing Cycle:</span>
          <span class="value">{{ subscription.billing_cycle_start | date }} - {{ subscription.billing_cycle_end | date }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Next Renewal:</span>
          <span class="value">{{ subscription.next_renewal_date | date }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Estimated Cost:</span>
          <span class="value">\${{ subscription.estimated_cost | number:'1.2-2' }}</span>
        </div>
      </div>

      <div class="actions" *ngIf="subscription.usage_percentage >= 80">
        <p-card styleClass="warning-card">
          <ng-template pTemplate="content">
            <div class="warning-content">
              <i class="pi pi-exclamation-triangle warning-icon"></i>
              <p>You've used {{ subscription.usage_percentage | number:'1.0-1' }}% of your monthly quota. Consider upgrading your plan or purchasing additional credits.</p>
            </div>
          </ng-template>
        </p-card>
      </div>
    </ng-template>
    <ng-template pTemplate="footer">
      <div class="card-actions">
        <p-button label="View Plans" [routerLink]="['/billing/plans']" severity="primary"></p-button>
        <p-button label="View Invoices" [routerLink]="['/billing/invoices']" severity="secondary" [text]="true"></p-button>
      </div>
    </ng-template>
  </p-card>

  <ng-template #loading>
    <app-loading-spinner message="Loading subscription details..."></app-loading-spinner>
  </ng-template>
</div>
