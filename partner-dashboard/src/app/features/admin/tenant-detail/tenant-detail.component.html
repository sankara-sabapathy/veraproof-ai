<div class="tenant-detail" *ngIf="tenant$ | async as tenant; else loading">
  <div class="header">
    <p-button 
      icon="pi pi-arrow-left" 
      [text]="true" 
      [rounded]="true"
      (onClick)="back()">
    </p-button>
    <h2>{{ tenant.email }}</h2>
  </div>

  <div class="detail-grid">
    <app-stat-card
      title="Total Sessions"
      [value]="tenant.total_sessions"
      icon="pi pi-shield"
      iconColor="primary">
    </app-stat-card>

    <app-stat-card
      title="Success Rate"
      [value]="(tenant.success_rate | number:'1.1-1') + '%'"
      icon="pi pi-check-circle"
      iconColor="primary">
    </app-stat-card>

    <app-stat-card
      title="Avg Trust Score"
      [value]="tenant.average_trust_score | number:'1.1-1'"
      icon="pi pi-star"
      iconColor="accent">
    </app-stat-card>

    <app-stat-card
      title="API Keys"
      [value]="tenant.api_keys_count"
      icon="pi pi-key"
      iconColor="primary">
    </app-stat-card>
  </div>

  <p-card styleClass="info-card">
    <ng-template pTemplate="header">
      <div class="card-header">Subscription Details</div>
    </ng-template>
    <ng-template pTemplate="content">
      <div class="info-grid">
        <div class="info-item">
          <span class="label">Subscription Tier:</span>
          <p-chip [label]="tenant.subscription_tier" styleClass="chip-primary"></p-chip>
        </div>
        <div class="info-item">
          <span class="label">Status:</span>
          <p-chip 
            [label]="tenant.status | uppercase" 
            [styleClass]="tenant.status === 'active' ? 'chip-primary' : 'chip-warn'">
          </p-chip>
        </div>
        <div class="info-item">
          <span class="label">Monthly Quota:</span>
          <span class="value">{{ tenant.monthly_quota | number }} verifications</span>
        </div>
        <div class="info-item">
          <span class="label">Current Usage:</span>
          <span class="value">{{ tenant.current_usage | number }} / {{ tenant.monthly_quota | number }}</span>
        </div>
        <div class="info-item full-width">
          <p-progressBar 
            [value]="getUsagePercentage(tenant.current_usage, tenant.monthly_quota)"
            [styleClass]="getUsagePercentage(tenant.current_usage, tenant.monthly_quota) >= 80 ? 'progress-warn' : 'progress-primary'">
          </p-progressBar>
        </div>
        <div class="info-item">
          <span class="label">Billing Cycle:</span>
          <span class="value">{{ tenant.billing_cycle_start | date }} - {{ tenant.billing_cycle_end | date }}</span>
        </div>
        <div class="info-item">
          <span class="label">Webhooks:</span>
          <span class="value">{{ tenant.webhooks_count }}</span>
        </div>
        <div class="info-item">
          <span class="label">Created:</span>
          <span class="value">{{ tenant.created_at | date }}</span>
        </div>
        <div class="info-item">
          <span class="label">Last Active:</span>
          <span class="value">{{ tenant.last_active_at | date }}</span>
        </div>
      </div>
    </ng-template>
    <ng-template pTemplate="footer">
      <div class="card-actions">
        <p-button 
          label="View Sessions" 
          icon="pi pi-list" 
          (onClick)="viewSessions()">
        </p-button>
      </div>
    </ng-template>
  </p-card>
</div>

<ng-template #loading>
  <app-loading-spinner message="Loading tenant details..."></app-loading-spinner>
</ng-template>
